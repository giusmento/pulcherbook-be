---
config:
  layout: elk
---
erDiagram
    partners ||--o{ teams : "partner_id"
    partners ||--o{ services : "partner_id"
    partners ||--o{ company_media : "partner_id"

    teams ||--o{ team_members : "team_id"
    teams ||--o{ team_services : "team_id"

    services ||--o{ team_services : "service_id"
    services ||--o{ appointments : "service_id"

    team_members ||--o{ appointments : "team_member_id"
    team_members ||--o{ team_member_availability : "team_member_id"

    partners {
        bigint id PK "Auto-increment"
        varchar owner_user_id UK "Index"
        varchar company_name "NOT NULL"
        text description
        varchar address
        varchar city
        varchar state
        varchar country
        varchar postal_code
        decimal latitude "10,8"
        decimal longitude "11,8"
        varchar phone
        varchar email
        varchar website
        enum status "active/inactive/pending"
        timestamp created_at
        timestamp updated_at
    }

    teams {
        bigint id PK "Auto-increment"
        bigint partner_id FK "Index"
        varchar name "NOT NULL"
        text description
        enum status "active/inactive"
        timestamp created_at
        timestamp updated_at
    }

    team_members {
        bigint id PK "Auto-increment"
        bigint team_id FK "Index"
        varchar user_id UK "Index, UNIQUE(team_id,user_id)"
        varchar role "member/admin"
        timestamp joined_at
        timestamp created_at
        timestamp updated_at
    }

    services {
        bigint id PK "Auto-increment"
        bigint partner_id FK "Index"
        varchar name "NOT NULL"
        text description
        integer duration_minutes "NOT NULL"
        decimal price "10,2 NOT NULL"
        varchar currency "USD"
        enum status "active/inactive"
        timestamp created_at
        timestamp updated_at
    }

    team_services {
        bigint id PK "Auto-increment"
        bigint team_id FK "Index, UNIQUE(team_id,service_id)"
        bigint service_id FK "Index"
        timestamp created_at
    }

    company_media {
        bigint id PK "Auto-increment"
        bigint partner_id FK "Index"
        varchar url "NOT NULL"
        enum type "logo/cover/gallery"
        integer display_order
        varchar alt_text
        timestamp created_at
        timestamp updated_at
    }

    appointments {
        bigint id PK "Auto-increment"
        varchar customer_user_id "Index"
        bigint team_member_id FK "Index"
        bigint service_id FK "Index"
        date appointment_date "Index"
        time start_time
        time end_time
        integer duration_minutes
        enum status "pending/confirmed/cancelled/completed/no_show"
        text notes
        text customer_notes
        text cancellation_reason
        timestamp created_at
        timestamp updated_at
    }

    team_member_availability {
        bigint id PK "Auto-increment"
        bigint team_member_id FK "Index"
        integer day_of_week "0-6 for recurring"
        date specific_date "Index, for one-time"
        time start_time
        time end_time
        boolean is_recurring "true/false"
        timestamp created_at
        timestamp updated_at
    }
